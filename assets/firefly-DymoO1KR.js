import{l as D,$ as b,m as C,p as V,q as i}from"./index-BGqpJpB7.js";const M=function(s){const e=s?"#fff62b":"#8cd629",t=10;let a=t,n=t;const r=t*2,o=t*2,{canvas:h,context:l}=C({width:r,height:o});let c=l.createRadialGradient(t,t,0,t,t,t);return c.addColorStop(0,"#fff"),c.addColorStop(.3,`${e}`),c.addColorStop(.5,`${e}cc`),c.addColorStop(.6,`${e}aa`),c.addColorStop(.7,`${e}88`),c.addColorStop(.8,`${e}66`),c.addColorStop(1,"transparent"),l.arc(a,n,t,0,Math.PI*2),l.fillStyle=c,l.fill(),h},F=(s,e,t,a=!1)=>{const n=Math.random()*Math.PI*2,r=a?t:t*Math.sqrt(Math.random()),o=s+r*Math.cos(n),h=e+r*Math.sin(n);return{x:o,y:h}};class p{constructor(e){this.context=null,this.canvas=null,this.creating=!1,this.fireflies=[],this.fireflyImg=[],this.maxPoi={x:0,y:0},this.startPoi={x:0,y:0},this.count=0,this.pathRandom=!0,this.speed=1,this.createSpeed=5,this.followMouse=!1,this.itemSpeed=1,this.mousedownSpeedRatio=10,this.mouseDownSign=!1,this.mousePoi={x:0,y:0},this.randomPaths=[],this.randomPathItv=0;const{el:t,count:a=50,ex:n=2e3,ey:r=100,sx:o,sy:h,success:l,pathRandom:c=!0,speed:d=1,createSpeed:x=5,followMouse:m=!1,mousedownSpeedRatio:f=10}=e;this.startPoi={x:o,y:h},this.maxPoi={x:n,y:r},this.mousePoi={x:n/2,y:r/2},this.mousedownSpeedRatio=f,this.followMouse=m,this.pathRandom=c,this.speed=d||1,this.createSpeed=x||5,this.count=a,this.mouseDownSign=!1;let P=D(e.el)?t:b(t);const{canvas:y,context:u}=C({width:n,height:r});this.canvas=y,this.context=u,P.appendChild(y),this.init(),typeof l=="function"&&l()}}const $=function(){this.randomPaths=[];const s=i(1,4);for(let e=0;e<s;e++){let t=this.createPathRandom(i(4,6));this.randomPaths.push(t)}},E=function(){const s=M(0),e=M(1);this.fireflyImg.push(s,e),this.setRandomPath(),this.randomPathItv=setInterval(()=>{this.setRandomPath()},1e3*5),this.mouseMove=V(t=>{this.updatePoi(t)},1e3/60),this.followMouse&&this.canvas.addEventListener("mousemove",this.mouseMove),this.followMouse&&(this.canvas.addEventListener("mousedown",this.mouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.mouseUp.bind(this))),this.increasedFirefly(this.count)},L=function(s){const e={x:s.clientX,y:s.clientY};this.mousePoi=e},T=function(){this.mouseDownSign=!0,this.setFirefliesVt(this.mousedownSpeedRatio),this.setRandomPath(),clearInterval(this.randomPathItv),this.randomPathItv=null},U=function(){this.mouseDownSign=!1,this.setFirefliesVt(1),this.setRandomPath(),this.randomPathItv=setInterval(()=>{this.setRandomPath()},1e3*5)},q=function(s=1){this.itemSpeed=s},A=function(){const s=this.maxPoi.x,e=this.maxPoi.y;return{x:i(0,s),y:i(0,e)}},G=function(s){const e=this.createRandomPoint();s.paths.push(e)},N=function(s=20){let e=0,t=[],a=[{x:0,y:0},{x:this.maxPoi.x,y:0},{x:this.maxPoi.x,y:this.maxPoi.y},{x:0,y:this.maxPoi.y}];for(t.push(a[i(0,3)]);e<s;){const n=this.createRandomPoint();t.push(n),e++}return t},O=function(){let s=0,e=[];e.push(this.startPoi);const t=this.maxPoi.x,a=t/20,n=0,r=this.maxPoi.y;for(;s<t;){let o=i(s,s+a),h=i(n,r);if(s=o,e.push({x:o,y:h}),i(0,100)<20){const c=e.lastItem(1),d=c.y>h;let x=i(o-a,o),m=d?i(n,c.y):i(c.y,r),f=i(o-2*a,o),P=h+i(-10,10),y=i(o-a,o),u=d?i(c.y,r):i(n,c.y),S=o+i(-20,20),w=h+i(-20,20);e.push({x,y:m},{x:f,y:P},{x:y,y:u},{x:S,y:w}),s=S}}return e},X=function(s=!1,e){let t=i(0,0);const a=this.fireflies[t],n=i(30,150)/30,r=i(0,1),o=s?a.frame+i(-120,120):i(256,1024)/this.speed,h=1/o,l=s?h*i(5,20)*this.itemSpeed:0,c=l*h,d=0,x=i(2,10)/10,m=i(2,6)/500,f=i(-30,30),P=s?a.paths.map(u=>({x:u.x+i(-f,f),y:u.y+i(-f,f)})):this.pathRandom?this.createPathRandom(6):this.createPathIncreasing(),y={radius:n,imgType:r,t:c,vt:h,nextFrame:l,frame:o,pathIndex:d,alpha:x,flashV:m,paths:P,onActive:!1,symbol:-1};this.fireflies.push(y)},Y=function(s){if(this.creating)return;let e=0;this.creating=!0;const t=1e3/this.createSpeed;let a=setInterval(()=>{const n=i(0,100)>5&&this.fireflies.length>3;e<s?(e++,this.createFirefly(n,e)):(clearInterval(a),a=null,this.creating=!1)},t)};function j(s,e,t,a,n){const r=(t.x-s.x)*.5,o=(a.x-e.x)*.5,h=(t.y-s.y)*.5,l=(a.y-e.y)*.5,c=n*n,d=n*c;return{x:(2*e.x-2*t.x+r+o)*d+(-3*e.x+3*t.x-2*r-o)*c+r*n+e.x,y:(2*e.y-2*t.y+h+l)*d+(-3*e.y+3*t.y-2*h-l)*c+h*n+e.y}}const k=function(s,e){let{paths:t,frame:a,nextFrame:n,vt:r,pathIndex:o,t:h,radius:l,imgType:c,alpha:d,flashV:x,symbol:m}=s;const f=o===0?t[0]:t[o-1],P=t[o],y=t[o+1],u=o===t.length-2?t[t.length-1]:t[o+2],{x:S,y:w}=j(f,P,y,u,h),g=this.context;if(g.save(),g.beginPath(),g.globalAlpha=d,g.drawImage(this.fireflyImg[c],S-l,w-l,l*2,l*2),g.restore(),h+=r*this.itemSpeed,d+=x*m,n+=1*this.itemSpeed,d>1&&(d=1,m=-1),d<.2&&(d=.2,m=1),n>=a||h>=1){if(o++,h=0,n=0,this.mouseDownSign){t.splice(o+1,t.length-1);const I=this.mousePoi.x,v=this.mousePoi.y,R=i(100)>98?200:50;t.push(F(I,v,i(-R,R))),t.push(F(I,v,i(-R,R)))}else if(o>=t.length-4){const I=this.randomPaths[e%this.randomPaths.length].map(v=>F(v.x,v.y,i(-50,50)));t.push(...I)}o>=3&&(s.paths.shift(),o--)}s.t=h,s.alpha=d,s.nextFrame=n,s.pathIndex=o,s.symbol=m,s.alpha=d},z=function(){const s=this.context;s.save();let e=s.createLinearGradient(0,0,1,this.maxPoi.y);e.addColorStop(0,"#02021366"),e.addColorStop(1,"#030e5e66"),s.fillStyle=e,s.fillRect(0,0,this.canvas.width,this.canvas.height),s.restore(),this.fireflies.forEach((t,a)=>{this.flyPath(t,a)})};p.prototype.init=E;p.prototype.mouseDown=T;p.prototype.mouseUp=U;p.prototype.updatePoi=L;p.prototype.setFirefliesVt=q;p.prototype.addPointToPath=G;p.prototype.createRandomPoint=A;p.prototype.increasedFirefly=Y;p.prototype.setRandomPath=$;p.prototype.createPathRandom=N;p.prototype.createPathIncreasing=O;p.prototype.createFirefly=X;p.prototype.flying=z;p.prototype.flyPath=k;export{p as F};
