class v{constructor(){this.stack=null,this.anm=null,this.running=!1,this.stack=[]}}function k(t){const{name:e,callback:s,args:o,id:n=null}=t;this.stack.push({id:n,name:e,args:o,callback:s}),this.$eventBegin()}function C(t){if(typeof t=="string"||typeof t=="number"){const n=this.stack.findIndex(r=>r.id==t);this.stack.splice(n,1),this.stack.length||this.eventEnd();return}const{name:e,id:s=null}=t,o=this.stack.findIndex(n=>s?n.id==s:n.name==e);this.stack.splice(o,1)}function E(){this.stack.length&&(this.stack.forEach(t=>{t.callback(t.args)}),this.running&&window.requestAnimationFrame(this.$run.bind(this)))}function A(){this.running||(this.running=!0,this.anm=window.requestAnimationFrame(this.$run.bind(this)))}function D(){this.running&&(this.running=!1,window.cancelAnimationFrame(this.anm),this.anm=null)}v.prototype.$register=k;v.prototype.$writeoff=C;v.prototype.$run=E;v.prototype.$eventBegin=A;v.prototype.$eventEnd=D;const W=new v,M=({width:t,height:e})=>{t=t||500,e=e||309;const s=document.createElement("canvas"),o=s.getContext("2d");return s.width=t,s.height=e,{canvas:s,context:o}},a=function(t,e){if(arguments.length<2&&(e=t,t=0),t>e){var s=e;e=t,t=s}return Math.floor(Math.random()*(e-t+1))+t},T=(t,e)=>{let s;return function(){let o=this,n=arguments;s||(s=setTimeout(function(){s=null,t.apply(o,n)},e))}},N=t=>typeof HTMLElement=="function"?t instanceof HTMLElement:t&&typeof t=="object"&&t.nodeType===1&&typeof t.nodeName=="string",V=t=>{const e=document.querySelectorAll(t);return e.length===1?e[0]:e};Array.prototype.lastItem=function(){return this[this.length-1]};Array.prototype.firstItem=function(){return this[0]};const I=function(t){const e=t?"#fff62b":"#8cd629",s=10;let o=s,n=s;const r=s*2,i=s*2,{canvas:h,context:l}=M({width:r,height:i});let c=l.createRadialGradient(s,s,0,s,s,s);return c.addColorStop(0,"#fff"),c.addColorStop(.2,"#fff"),c.addColorStop(.3,`${e}`),c.addColorStop(.5,`${e}cc`),c.addColorStop(.6,`${e}aa`),c.addColorStop(.7,`${e}88`),c.addColorStop(.8,`${e}66`),c.addColorStop(1,"transparent"),l.arc(o,n,s,0,Math.PI*2),l.fillStyle=c,l.fill(),h},R=(t,e,s)=>{const o=Math.random()*Math.PI*2,n=s*Math.sqrt(Math.random()),r=t+n*Math.cos(o),i=e+n*Math.sin(o);return{x:r,y:i}};class f{constructor(e){this.context=null,this.canvas=null,this.creating=!1,this.fireflies=[],this.fireflyImg=[],this.maxPoi={x:0,y:0},this.startPoi={x:0,y:0},this.count=0,this.pathRandom=!0,this.speed=1,this.createSpeed=5,this.followMouse=!1,this.itemSpeed=1,this.mousedownSpeedRatio=10,this.mouseDownSign=!1,this.mousePoi={x:0,y:0};const{el:s,count:o=50,ex:n=2e3,ey:r=100,sx:i,sy:h,success:l,pathRandom:c=!0,speed:u=1,createSpeed:y=5,followMouse:p=!1,mousedownSpeedRatio:P=10}=e;this.startPoi={x:i,y:h},this.maxPoi={x:n,y:r},this.mousePoi={x:n/2,y:r/2},this.mousedownSpeedRatio=P,this.followMouse=p,this.pathRandom=c,this.speed=u||1,this.createSpeed=y||5,this.count=o,this.mouseDownSign=!1;let d=N(e.el)?s:V(s);const{canvas:m,context:x}=M({width:n,height:r});this.canvas=m,this.context=x,d.appendChild(m),this.init(),typeof l=="function"&&l()}}const L=function(){const t=I(0),e=I(1);this.fireflyImg.push(t,e),this.fittingPath=this.createPathRandom(12),this.mouseMove=T(s=>{this.updatePoi(s)},50),this.followMouse&&this.canvas.addEventListener("mousemove",this.mouseMove),this.followMouse&&(this.canvas.addEventListener("mousedown",this.mouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.mouseUp.bind(this))),this.increasedFirefly(this.count)},q=function(t){const e={x:t.clientX,y:t.clientY};this.mousePoi=e},B=function(){this.mouseDownSign=!0,this.setFirefliesVt(this.mousedownSpeedRatio)},U=function(){this.mouseDownSign=!1,this.setFirefliesVt(1)},H=function(t=1){this.itemSpeed=t},j=function(t=0,e){},G=function(){const t=this.maxPoi.x,e=this.maxPoi.y;return{x:a(0,t),y:a(0,e)}},O=function(t){const e=this.createRandomPoint();t.paths.push(e)},X=function(t=20){let e=0,s=[];for(s.push(this.startPoi);e<t;){const o=this.createRandomPoint();s.push(o),e++}return s},Y=function(){let t=this.startPoi.x,e=[];e.push(this.startPoi);const s=this.maxPoi.x,o=s/20,n=5,r=this.maxPoi.y;for(;t<s;){let i=a(t,t+o),h=a(n,r);if(t=i,e.push({x:i,y:h}),a(0,100)<20){const c=e.lastItem(1),u=c.y>h;let y=a(i-o,i),p=u?a(n,c.y):a(c.y,r),P=a(i-2*o,i),d=h+a(-10,10),m=a(i-o,i),x=u?a(c.y,r):a(n,c.y),g=i+a(-20,20),S=h+a(-20,20);e.push({x:y,y:p},{x:P,y:d},{x:m,y:x},{x:g,y:S}),t=g}}return e},_=function(t=!1,e){let s=a(0,2);const o=this.fireflies[s],n=a(20,60)/10,r=a(0,1),i=this.startPoi,h=t?o.frameNumber:a(256,612)/this.speed,l=1/h,c=t?l*a(5,20)*this.itemSpeed:0,u=c*l,y=0,p=a(2,10)/10,P=a(2,6)/500,d=100+e,m=t?o.paths.map(g=>({x:g.x+a(-d,d)/10,y:g.y+a(-d,d)/10})):this.pathRandom?this.createPathRandom(6):this.createPathIncreasing(),x={radius:n,imgType:r,nextPoi:i,t:u,vt:l,nextFrame:c,frameNumber:h,pathNumber:y,alpha:p,flashV:P,paths:m,onActive:!1,symbol:-1,fitted:!1};this.fireflies.push(x)},z=function(t){if(this.creating)return;let e=0;this.creating=!0;const s=setInterval(()=>{const o=a(0,100)>10&&this.fireflies.length>3;e<t?(e++,this.createFirefly(o,e)):(clearInterval(s),this.creating=!1)},1e3/this.createSpeed)};function J(t,e,s,o,n){const r=(s.x-t.x)*.5,i=(o.x-e.x)*.5,h=(s.y-t.y)*.5,l=(o.y-e.y)*.5,c=n*n,u=n*c;return{x:(2*e.x-2*s.x+r+i)*u+(-3*e.x+3*s.x-2*r-i)*c+r*n+e.x,y:(2*e.y-2*s.y+h+l)*u+(-3*e.y+3*s.y-2*h-l)*c+h*n+e.y}}const K=function(t,e){let{paths:s,frameNumber:o,nextFrame:n,vt:r,pathNumber:i,t:h,radius:l,imgType:c,alpha:u,flashV:y,symbol:p,fitted:P}=t;const d=i===0?s[0]:s[i-1],m=s[i],x=s[i+1],g=i===s.length-2?s[s.length-1]:s[i+2],{x:S,y:$}=J(d,m,x,g,h),w=this.context;if(w.save(),w.beginPath(),w.globalAlpha=u,w.drawImage(this.fireflyImg[c],S-l,$-l,l*2,l*2),w.restore(),h+=r*this.itemSpeed,u+=y*p,n+=1*this.itemSpeed,u>1&&(u=1,p=-1),u<.2&&(u=.2,p=1),n>=o||h>=1){if(i++,h=0,n=0,!this.mouseDownSign)i>=s.length-4&&this.addPointToPath(t);else{s.splice(i+1,s.length-1);const b=this.mousePoi.x,F=this.mousePoi.y;s.push(R(b,F,a(50,200))),s.push(R(b,F,a(50,200)))}i>=3&&(t.paths.shift(),i--)}t.t=h,t.alpha=u,t.nextFrame=n,t.pathNumber=i,t.symbol=p,t.alpha=u},Q=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.fireflies.forEach((t,e)=>{this.flyPath(t,e)})};f.prototype.init=L;f.prototype.mouseDown=B;f.prototype.mouseUp=U;f.prototype.updatePoi=q;f.prototype.setFirefliesVt=H;f.prototype.addPointToPath=O;f.prototype.createRandomPoint=G;f.prototype.increasedFirefly=z;f.prototype.checekFirefliesPoint=j;f.prototype.createPathRandom=X;f.prototype.createPathIncreasing=Y;f.prototype.createFirefly=_;f.prototype.flying=Q;f.prototype.flyPath=K;export{f as F,W as a};
