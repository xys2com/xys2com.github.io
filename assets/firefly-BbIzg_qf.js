class P{constructor(){this.stack=null,this.anm=null,this.running=!1,this.stack=[]}}function b(t){const{name:e,callback:s,args:o,id:n=null}=t;this.stack.push({id:n,name:e,args:o,callback:s}),this.$eventBegin()}function k(t){if(typeof t=="string"||typeof t=="number"){const n=this.stack.findIndex(h=>h.id==t);this.stack.splice(n,1),this.stack.length||this.eventEnd();return}const{name:e,id:s=null}=t,o=this.stack.findIndex(n=>s?n.id==s:n.name==e);this.stack.splice(o,1)}function C(){this.stack.length&&(this.stack.forEach(t=>{t.callback(t.args)}),this.running&&window.requestAnimationFrame(this.$run.bind(this)))}function E(){this.running||(this.running=!0,this.anm=window.requestAnimationFrame(this.$run.bind(this)))}function A(){this.running&&(this.running=!1,window.cancelAnimationFrame(this.anm),this.anm=null)}P.prototype.$register=b;P.prototype.$writeoff=k;P.prototype.$run=C;P.prototype.$eventBegin=E;P.prototype.$eventEnd=A;const K=new P,$=({width:t,height:e})=>{t=t||500,e=e||309;const s=document.createElement("canvas"),o=s.getContext("2d");return s.width=t,s.height=e,{canvas:s,context:o}},a=function(t,e){if(arguments.length<2&&(e=t,t=0),t>e){var s=e;e=t,t=s}return Math.floor(Math.random()*(e-t+1))+t},D=(t,e)=>{let s;return function(){let o=this,n=arguments;s||(s=setTimeout(function(){s=null,t.apply(o,n)},e))}},T=t=>typeof HTMLElement=="function"?t instanceof HTMLElement:t&&typeof t=="object"&&t.nodeType===1&&typeof t.nodeName=="string",V=t=>{const e=document.querySelectorAll(t);return e.length===1?e[0]:e};Array.prototype.lastItem=function(){return this[this.length-1]};Array.prototype.firstItem=function(){return this[0]};const M=function(t){const e=t?"#fff62b":"#8cd629",s=10;let o=s,n=s;const h=s*2,i=s*2,{canvas:r,context:l}=$({width:h,height:i});let c=l.createRadialGradient(s,s,0,s,s,s);return c.addColorStop(0,"#fff"),c.addColorStop(.2,"#fff"),c.addColorStop(.3,`${e}`),c.addColorStop(.5,`${e}cc`),c.addColorStop(.6,`${e}aa`),c.addColorStop(.7,`${e}88`),c.addColorStop(.8,`${e}66`),c.addColorStop(1,"transparent"),l.arc(o,n,s,0,Math.PI*2),l.fillStyle=c,l.fill(),r},F=(t,e,s)=>{const o=Math.random()*Math.PI*2,n=s*Math.sqrt(Math.random()),h=t+n*Math.cos(o),i=e+n*Math.sin(o);return{x:h,y:i}};class u{constructor(e){this.context=null,this.canvas=null,this.creating=!1,this.fireflies=[],this.fireflyImg=[],this.maxPoi={x:0,y:0},this.startPoi={x:0,y:0},this.count=0,this.pathRandom=!0,this.speed=1,this.createSpeed=5,this.followMouse=!1,this.itemSpeed=1,this.mousedownSpeedRatio=10,this.mouseDownSign=!1,this.mousePoi={x:0,y:0};const{el:s,count:o=50,ex:n=2e3,ey:h=100,sx:i,sy:r,success:l,pathRandom:c=!0,speed:f=1,createSpeed:x=5,followMouse:d=!1,mousedownSpeedRatio:p=10}=e;this.startPoi={x:i,y:r},this.maxPoi={x:n,y:h},this.mousePoi={x:n/2,y:h/2},this.mousedownSpeedRatio=p,this.followMouse=d,this.pathRandom=c,this.speed=f||1,this.createSpeed=x||5,this.count=o,this.mouseDownSign=!1;let g=T(e.el)?s:V(s);const{canvas:m,context:y}=$({width:n,height:h});this.canvas=m,this.context=y,g.appendChild(m),this.init(),typeof l=="function"&&l()}}const L=function(){const t=M(0),e=M(1);this.fireflyImg.push(t,e),this.fittingPath=this.createPathRandom(6),this.mouseMove=D(s=>{this.updatePoi(s)},50),this.followMouse&&this.canvas.addEventListener("mousemove",this.mouseMove),this.followMouse&&(this.canvas.addEventListener("mousedown",this.mouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.mouseUp.bind(this))),this.increasedFirefly(this.count)},q=function(t){const e={x:t.clientX,y:t.clientY};this.mousePoi=e},B=function(){this.mouseDownSign=!0,this.setFirefliesVt(this.mousedownSpeedRatio),this.fittingPath=this.createPathRandom(6)},U=function(){this.mouseDownSign=!1,this.setFirefliesVt(1)},H=function(t=1){this.itemSpeed=t},j=function(){const t=this.maxPoi.x,e=this.maxPoi.y;return{x:a(0,t),y:a(0,e)}},G=function(t){const e=this.createRandomPoint();t.paths.push(e)},N=function(t=20){let e=0,s=[];for(s.push(this.startPoi);e<t;){const o=this.createRandomPoint();s.push(o),e++}return s},O=function(){let t=this.startPoi.x,e=[];e.push(this.startPoi);const s=this.maxPoi.x,o=s/20,n=5,h=this.maxPoi.y;for(;t<s;){let i=a(t,t+o),r=a(n,h);if(t=i,e.push({x:i,y:r}),a(0,100)<20){const c=e.lastItem(1),f=c.y>r;let x=a(i-o,i),d=f?a(n,c.y):a(c.y,h),p=a(i-2*o,i),g=r+a(-10,10),m=a(i-o,i),y=f?a(c.y,h):a(n,c.y),w=i+a(-20,20),S=r+a(-20,20);e.push({x,y:d},{x:p,y:g},{x:m,y},{x:w,y:S}),t=w}}return e},X=function(t=!1,e){let s=a(0,2);const o=this.fireflies[s],n=a(20,60)/10,h=a(0,1),i=t?o.frame+a(-120,120):a(256,1024)/this.speed,r=1/i,l=t?r*a(5,20)*this.itemSpeed:0,c=l*r,f=0,x=a(2,10)/10,d=a(2,6)/500,p=100+e,g=t?o.paths.map(y=>({x:y.x+a(-p,p)/10,y:y.y+a(-p,p)/10})):this.pathRandom?this.createPathRandom(6):this.createPathIncreasing(),m={radius:n,imgType:h,t:c,vt:r,nextFrame:l,frame:i,pathIndex:f,alpha:x,flashV:d,paths:g,onActive:!1,symbol:-1};this.fireflies.push(m)},Y=function(t){if(this.creating)return;let e=0;this.creating=!0;const s=setInterval(()=>{const o=a(0,100)>10&&this.fireflies.length>3;e<t?(e++,this.createFirefly(o,e)):(clearInterval(s),this.creating=!1)},1e3/this.createSpeed)};function _(t,e,s,o,n){const h=(s.x-t.x)*.5,i=(o.x-e.x)*.5,r=(s.y-t.y)*.5,l=(o.y-e.y)*.5,c=n*n,f=n*c;return{x:(2*e.x-2*s.x+h+i)*f+(-3*e.x+3*s.x-2*h-i)*c+h*n+e.x,y:(2*e.y-2*s.y+r+l)*f+(-3*e.y+3*s.y-2*r-l)*c+r*n+e.y}}const z=function(t,e){let{paths:s,frame:o,nextFrame:n,vt:h,pathIndex:i,t:r,radius:l,imgType:c,alpha:f,flashV:x,symbol:d}=t;const p=i===0?s[0]:s[i-1],g=s[i],m=s[i+1],y=i===s.length-2?s[s.length-1]:s[i+2],{x:w,y:S}=_(p,g,m,y,r),v=this.context;if(v.save(),v.beginPath(),v.globalAlpha=f,v.drawImage(this.fireflyImg[c],w-l,S-l,l*2,l*2),v.restore(),r+=h*this.itemSpeed,f+=x*d,n+=1*this.itemSpeed,f>1&&(f=1,d=-1),f<.2&&(f=.2,d=1),n>=o||r>=1){if(i++,r=0,n=0,!this.mouseDownSign)i>=s.length-4&&this.addPointToPath(t);else{s.splice(i+1,s.length-1);const I=this.mousePoi.x,R=this.mousePoi.y;s.push(F(I,R,a(50,200))),s.push(F(I,R,a(50,200)))}i>=3&&(t.paths.shift(),i--)}t.t=r,t.alpha=f,t.nextFrame=n,t.pathIndex=i,t.symbol=d,t.alpha=f},J=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.fireflies.forEach((t,e)=>{this.flyPath(t,e)})};u.prototype.init=L;u.prototype.mouseDown=B;u.prototype.mouseUp=U;u.prototype.updatePoi=q;u.prototype.setFirefliesVt=H;u.prototype.addPointToPath=G;u.prototype.createRandomPoint=j;u.prototype.increasedFirefly=Y;u.prototype.createPathRandom=N;u.prototype.createPathIncreasing=O;u.prototype.createFirefly=X;u.prototype.flying=J;u.prototype.flyPath=z;export{u as F,K as a};
