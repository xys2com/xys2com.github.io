import{l as C,$ as D,m as M,p as b,q as o}from"./index-DOf2nXYm.js";const F=function(e){const s=e?"#fff62b":"#8cd629",t=10;let h=t,n=t;const l=t*2,i=t*2,{canvas:c,context:r}=M({width:l,height:i});let a=r.createRadialGradient(t,t,0,t,t,t);return a.addColorStop(0,"#fff"),a.addColorStop(.3,`${s}`),a.addColorStop(.5,`${s}cc`),a.addColorStop(.6,`${s}aa`),a.addColorStop(.7,`${s}88`),a.addColorStop(.8,`${s}66`),a.addColorStop(1,"transparent"),r.arc(h,n,t,0,Math.PI*2),r.fillStyle=a,r.fill(),c},S=(e,s,t)=>{const h=Math.random()*Math.PI*2,n=t*Math.sqrt(Math.random()),l=e+n*Math.cos(h),i=s+n*Math.sin(h);return{x:l,y:i}};class d{constructor(s){this.context=null,this.canvas=null,this.creating=!1,this.fireflies=[],this.fireflyImg=[],this.maxPoi={x:0,y:0},this.startPoi={x:0,y:0},this.count=0,this.pathRandom=!0,this.speed=1,this.createSpeed=5,this.followMouse=!1,this.itemSpeed=1,this.mousedownSpeedRatio=10,this.mouseDownSign=!1,this.mousePoi={x:0,y:0},this.randomPaths=[],this.randomPathItv=0;const{el:t,count:h=50,ex:n=2e3,ey:l=100,sx:i,sy:c,success:r,pathRandom:a=!0,speed:m=1,createSpeed:x=5,followMouse:p=!1,mousedownSpeedRatio:u=10}=s;this.startPoi={x:i,y:c},this.maxPoi={x:n,y:l},this.mousePoi={x:n/2,y:l/2},this.mousedownSpeedRatio=u,this.followMouse=p,this.pathRandom=a,this.speed=m||1,this.createSpeed=x||5,this.count=h,this.mouseDownSign=!1;let f=C(s.el)?t:D(t);const{canvas:y,context:P}=M({width:n,height:l});this.canvas=y,this.context=P,f.appendChild(y),this.init(),typeof r=="function"&&r()}}const T=function(){this.randomPaths=[];const e=o(1,4);for(let s=0;s<e;s++){let t=this.createPathRandom(o(4,6));this.randomPaths.push(t)}},V=function(){const e=F(0),s=F(1);this.fireflyImg.push(e,s),this.setRandomPath(),this.randomPathItv=setInterval(()=>{this.setRandomPath()},1e3*5),this.mouseMove=b(t=>{this.updatePoi(t)},50),this.followMouse&&this.canvas.addEventListener("mousemove",this.mouseMove),this.followMouse&&(this.canvas.addEventListener("mousedown",this.mouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.mouseUp.bind(this))),this.increasedFirefly(this.count)},$=function(e){const s={x:e.clientX,y:e.clientY};this.mousePoi=s},E=function(){this.mouseDownSign=!0,this.setFirefliesVt(this.mousedownSpeedRatio),this.setRandomPath(),clearInterval(this.randomPathItv),this.randomPathItv=null},L=function(){this.mouseDownSign=!1,this.setFirefliesVt(1),this.setRandomPath(),this.randomPathItv=setInterval(()=>{this.setRandomPath()},1e3*5)},U=function(e=1){this.itemSpeed=e},q=function(){const e=this.maxPoi.x,s=this.maxPoi.y;return{x:o(0,e),y:o(0,s)}},A=function(e){const s=this.createRandomPoint();e.paths.push(s)},G=function(e=20){let s=0,t=[],h=[{x:this.maxPoi.x/3,y:this.maxPoi.y/3},{x:this.maxPoi.x/3*2,y:this.maxPoi.y/3},{x:this.maxPoi.x/3*2,y:this.maxPoi.y/3*2},{x:this.maxPoi.x/3,y:this.maxPoi.y/3*2}];for(t.push(h[o(0,3)]);s<e;){const n=this.createRandomPoint();t.push(n),s++}return t},N=function(){let e=this.maxPoi.x/3,s=[];s.push(this.startPoi);const t=this.maxPoi.x/3*2,h=t/20,n=this.maxPoi.y/3,l=this.maxPoi.y/3*2;for(;e<t;){let i=o(e,e+h),c=o(n,l);if(e=i,s.push({x:i,y:c}),o(0,100)<20){const a=s.lastItem(1),m=a.y>c;let x=o(i-h,i),p=m?o(n,a.y):o(a.y,l),u=o(i-2*h,i),f=c+o(-10,10),y=o(i-h,i),P=m?o(a.y,l):o(n,a.y),g=i+o(-20,20),w=c+o(-20,20);s.push({x,y:p},{x:u,y:f},{x:y,y:P},{x:g,y:w}),e=g}}return s},O=function(e=!1,s){let t=o(0,2);const h=this.fireflies[t],l=o(1,100)==1?o(30,100):o(30,600)/30,i=o(0,1),c=e?h.frame+o(-120,120):o(256,1024)/this.speed,r=1/c,a=e?r*o(5,20)*this.itemSpeed:0,m=a*r,x=0,p=o(2,10)/10,u=o(2,6)/500,f=o(100),y=e?h.paths.map(g=>({x:g.x+o(-f,f),y:g.y+o(-f,f)})):this.pathRandom?this.createPathRandom(6):this.createPathIncreasing(),P={radius:l,imgType:i,t:m,vt:r,nextFrame:a,frame:c,pathIndex:x,alpha:p,flashV:u,paths:y,onActive:!1,symbol:-1};this.fireflies.push(P)},X=function(e){if(this.creating)return;let s=0;this.creating=!0;const t=1e3/this.createSpeed;let h=setInterval(()=>{const n=o(0,100)>5&&this.fireflies.length>3;s<e?(s++,this.createFirefly(n,s)):(clearInterval(h),h=null,this.creating=!1)},t)};function Y(e,s,t,h,n){const l=(t.x-e.x)*.5,i=(h.x-s.x)*.5,c=(t.y-e.y)*.5,r=(h.y-s.y)*.5,a=n*n,m=n*a;return{x:(2*s.x-2*t.x+l+i)*m+(-3*s.x+3*t.x-2*l-i)*a+l*n+s.x,y:(2*s.y-2*t.y+c+r)*m+(-3*s.y+3*t.y-2*c-r)*a+c*n+s.y}}const j=function(e,s){let{paths:t,frame:h,nextFrame:n,vt:l,pathIndex:i,t:c,radius:r,imgType:a,alpha:m,flashV:x,symbol:p}=e;const u=i===0?t[0]:t[i-1],f=t[i],y=t[i+1],P=i===t.length-2?t[t.length-1]:t[i+2],{x:g,y:w}=Y(u,f,y,P,c),v=this.context;if(v.save(),v.beginPath(),v.globalAlpha=m,v.drawImage(this.fireflyImg[a],g-r,w-r,r*2,r*2),v.restore(),c+=l*this.itemSpeed,m+=x*p,n+=1*this.itemSpeed,m>1&&(m=1,p=-1),m<.2&&(m=.2,p=1),n>=h||c>=1){if(i++,c=0,n=0,this.mouseDownSign){t.splice(i+1,t.length-1);const R=this.mousePoi.x,I=this.mousePoi.y;t.push(S(R,I,o(-100,100))),t.push(S(R,I,o(-100,100)))}else if(i>=t.length-4){const R=this.randomPaths[s%this.randomPaths.length].map(I=>S(I.x,I.y,o(-50,50)));t.push(...R)}i>=3&&(e.paths.shift(),i--)}e.t=c,e.alpha=m,e.nextFrame=n,e.pathIndex=i,e.symbol=p,e.alpha=m},k=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.fireflies.forEach((e,s)=>{this.flyPath(e,s)})};d.prototype.init=V;d.prototype.mouseDown=E;d.prototype.mouseUp=L;d.prototype.updatePoi=$;d.prototype.setFirefliesVt=U;d.prototype.addPointToPath=A;d.prototype.createRandomPoint=q;d.prototype.increasedFirefly=X;d.prototype.setRandomPath=T;d.prototype.createPathRandom=G;d.prototype.createPathIncreasing=N;d.prototype.createFirefly=O;d.prototype.flying=k;d.prototype.flyPath=j;export{d as F};
